<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <link rel="stylesheet" href="../style.css">
    <link href="style2.css" rel="stylesheet">
    <script src="../jquery.min.js"></script>

    <style>
        @font-face {
            font-family: myFirstFont;
            src: url(../myfont.otf);
            font-weight: bold;
        }

        body {
            margin: 0;
            padding: 0;
        }

        div {
            font-family: myFirstFont;
        }

        .module {
            background: linear-gradient(
                    rgba(0, 0, 0, 0.6),
                    rgba(0, 0, 0, 0.6)
            ),
            url(../informatics.jpg);
            background-size: cover;
            /*width: 300px;
            height: 200px;
            margin: 10px 0 0 10px;*/
            /*height: 0;
            padding-bottom: 13em;
            padding-top:3em;*/
            position: relative;
            float: left;
        }

    </style>
    <title>
        مقرر قواعد المعطيات
    </title>
    <style>
        a {
            text-decoration: none !important;
        }
    </style>
    <style>
        .cppcode {
            font-family: Consolas, Monaco, Lucida Console, Liberation Mono, DejaVu Sans Mono, Bitstream Vera Sans Mono, Courier New;
        }
    </style>
    <script>
        (function (i, s, o, g, r, a, m) {
            i['GoogleAnalyticsObject'] = r;
            i[r] = i[r] || function () {
                    (i[r].q = i[r].q || []).push(arguments)
                }, i[r].l = 1 * new Date();
            a = s.createElement(o),
                m = s.getElementsByTagName(o)[0];
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m)
        })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

        ga('create', 'UA-96941597-1', 'auto');
        ga('send', 'pageview');

    </script>
    <script>
        function submit() {
            if ($('#aname').val().trim() == "") {
                alert('اكتب الاسم الثلاثي قبل الإرسال');
                return;
            }
            if ($('#solution').val().trim() == "") {
                alert('الصق حل الوظيفة في الفراغ قبل الإرسال');
                return;
            }
            if ($('#solution').val().length < 5) {
                alert('الحل قصير جدا! الصق حلا مفيدا');
                return;
            }
            var studentname = $('#aname').val();
            var studentid = $('#sid').val();
            var studentsolution = $('#solution').val();
            var homeworknumber = $('#no').val();
            $('#submit').html('جار إرسال الحل...');
            $('#submit').prop("disabled", true);
            $.ajax({
                url: 'https://informatics.ga/submit',
                type: 'POST',
                cache: false,
                data: {
                    name: studentname,
                    sid: studentid,
                    solution: studentsolution,
                    no: homeworknumber
                },

                success: function (response) {
                    if (response)
                        $('#homework').html('<div class="w3-panel w3-yellow w3-xlarge" style="margin-left:20%;margin-right:20%;margin-top:30%-margin-bottom:30%"><p class="w3-xxlarge w3-center">تم إرسال الحل بنجاح!</p><p class="w3-center">كل وظيفة وأنت بخير :)</p></div>');

                    else {
                        $('#submit').html('إرسال');
                        $('#submit').prop("disabled", false);
                        alert('حدث خطأ أثناء عملية الإرسال.. قم بتحديث الصفحة وإعادة الإرسال من جديد!');
                    }
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    alert('حدث خطأ أثناء الإرسال، تأكد من توفر اتصال بالانترنت وأعد تحميل الصفحة');
                }

            });

        }
    </script>
</head>
<body dir='rtl' class='w3-light-grey'>
<div class='w3-row w3-container w3-display-container' style='margin:0;padding:0;'>
    <div class='w3-container module w3-center'
         style="width:100%; margin:0;display: table-cell !important; vertical-align: middle !important;">
        <p class='w3-jumbo w3-text-white'>قواعد المعطيات</p>
    </div>
</div>
<div class='w3-row'>

    <div class="w3-container w3-blue w3-large w3-border">
        &nbsp;
    </div>
    <div class='w3-row' style='position:relative;'>
        <div class='w3-col' style='width:10%;height:100%;'>
            &nbsp;
        </div>
        <div class='w3-container w3-col' style="width:80%">
            <p class='w3-xxxlarge w3-center w3-text-red' style='margin-bottom:0;'>الوظيفة الرابعة</p>
            <div id="homework">
                <p class='w3-xlarge' style='margin-top:0;'>
                    قم برسم المخطط على ورقة أو على الكمبيوتر واحفظ الحل على شكل صورة يوضع عليها اسمك الثلاثي بشكل واضح، ثم قم بتحميل الصورة من الزر الموافق للسؤال الأول، وقم بلصق حل السؤال الثاني في المكان الموافق له، ثم اضغط على زر إرسال.
             </p>
                <div id="form">
                    <div class="w3-row">
                        <div class="w3-col l4" style="padding-left:30px;">
                            <label class='w3-text-blue w3-xlarge'>الرقم الجامعي:</label>
                            <input id="sid" class="w3-input w3-border w3-xlarge" type='number' min='1' max='100000' name='sid' required>
                        </div>

                        <div class="w3-col l4" style="padding-left:30px;">
                            <label class='w3-text-blue w3-xlarge'>الاسم الثلاثي (بالانكليزية):</label>
                            <input id="ename" class="w3-input w3-border w3-xlarge" type='text' name='ename' class='w3-input'>
                        </div>

                        <div class="w3-col l4" style="padding-left:30px;">
                            <label class='w3-text-blue w3-xlarge'>الاسم الثلاثي (بالعربية):</label>
                            <input id="aname" class="w3-input w3-border w3-xlarge" type='text' name='fname' class='w3-input' required pattern="[\u0600-\u065F\u066A-\u06EF\u06FA-\u06FF ]+" title='أدخل اسم صحيح باللغة العربية'>
                        </div>

                    </div>
                    <label class='w3-text-blue w3-xlarge'>حل السؤال الأول:</label>
                    <div class="form-wrap" style="margin-top:0;margin-bottom:0;padding-top:0">
                        <h3>تحميل مخطط E-R Diagram</h3>
                        <form action="https://informatics.ga/upload" method="post" enctype="multipart/form-data" id="upload_form">
                            <input name="__files[]" type="file" multiple />
                            <input name="__submit__" type="submit" value="تحميل"/>
                            <input id="stename" name="stename" type="hidden"/>
                        </form>
                        <div id="progress-wrp"><div class="progress-bar"></div ><div class="status">0%</div></div>
                        <div id="output">تم تحميل الصورة بنجاح!</div>
                    </div>
                    <label class='w3-text-blue w3-xlarge'>حل السؤال الثاني:</label>
                    <textarea id="solution" dir='ltr' class="w3-input w3-border cppcode" type='textarea' rows="10" cols="50" name='ex1' placeholder="الصق الحل هنا"  required ></textarea>
                    <br>
                    <button id="submit" class="w3-btn-block w3-green w3-xxlarge" onclick="submit();"><b>إرسال</b></button>
                    <input type="hidden" name="number" id="no" value="4" />

                </div>

            </div>
        </div>

        <div class='w3-col' style='width:10%;height:100%;'>
            &nbsp;
        </div>
    </div>
</div>
</br>
<div class="w3-container w3-center w3-blue">
    <h6><a href='https://www.facebook.com/3li3rous' style='text-decoration: none !important;'>Eng. Ali Arous ©
        2017</a></h6>
</div>
<script type="text/javascript">

    //configuration
    var max_file_size 			= 12048576; //allowed file size. (1 MB = 1048576)
    var allowed_file_types 		= ['image/png', 'image/gif', 'image/jpeg', 'image/pjpeg']; //allowed file types
    var result_output 			= '#output'; //ID of an element for response output
    var my_form_id 				= '#upload_form'; //ID of an element for response output
    var progress_bar_id 		= '#progress-wrp'; //ID of an element for response output
    var total_files_allowed 	= 1; //Number files allowed to upload

    $(result_output).hide();

    //on form submit
    $(my_form_id).on( "submit", function(event) {
        event.preventDefault();
        var proceed = true; //set proceed flag
        var error = [];	//errors
        var total_files_size = 0;

        //reset progressbar
        $(progress_bar_id +" .progress-bar").css("width", "0%");
        $(progress_bar_id + " .status").text("0%");

        var stname = $('#ename').val();

        $("#stename").attr("value",stname);


        if(!window.File && window.FileReader && window.FileList && window.Blob){ //if browser doesn't supports File API
            error.push("Your browser does not support new File API! Please upgrade."); //push error text
        }else{
            var total_selected_files = this.elements['__files[]'].files.length; //number of files

            //limit number of files allowed
            if(total_selected_files > total_files_allowed){
                error.push( "لقد حددت صورة بحجم، والحد الأقصى المسموح للحجم هو:" + total_files_allowed +" !"); //push error text
                proceed = false; //set proceed flag to false
            }
            //iterate files in file input field
            $(this.elements['__files[]'].files).each(function(i, ifile){
                if(ifile.value !== ""){ //continue only if file(s) are selected
                    if(allowed_file_types.indexOf(ifile.type) === -1){ //check unsupported file
                        error.push( "<b>"+ ifile.name + "</b> نوع الملفات هذا غير مدعوم!"); //push error text
                        proceed = false; //set proceed flag to false
                    }

                    total_files_size = total_files_size + ifile.size; //add file size to total size
                }
            });

            //if total file size is greater than max file size
            if(total_files_size > max_file_size){
                error.push("الحجم أكبر من المسموح");
                //error.push( "لقد حددت صورة بحجم: "+total_files_size+"، والحد الأقصى المسموح هو: " + max_file_size +", حمل ملف أصغر حجماً!"); //push error text
                proceed = false; //set proceed flag to false
            }

            var submit_btn  = $(this).find("input[type=submit]"); //form submit button

            //if everything looks good, proceed with jQuery Ajax
            if(proceed){
                //submit_btn.val("Please Wait...").prop( "disabled", true); //disable submit button
                var form_data = new FormData(this); //Creates new FormData object
                var post_url = $(this).attr("action"); //get action URL of form

                //jQuery Ajax to Post form data
                $.ajax({
                    url : post_url,
                    type: "POST",
                    data : form_data,
                    cache: false,
                    processData:false,
                    xhr: function(){
                        //upload Progress
                        var xhr = $.ajaxSettings.xhr();
                        if (xhr.upload) {
                            xhr.upload.addEventListener('progress', function(event) {
                                var percent = 0;
                                var position = event.loaded || event.position;
                                var total = event.total;
                                if (event.lengthComputable) {
                                    percent = Math.ceil(position / total * 100);
                                }
                                //update progressbar
                                $(progress_bar_id +" .progress-bar").css("width", + percent +"%");
                                $(progress_bar_id + " .status").text(percent +"%");
                            }, true);
                        }
                        return xhr;
                    },
                    mimeType:"multipart/form-data"
                }).done(function(res){ //
                    $(my_form_id)[0].reset(); //reset form
                    $(result_output).show(); //output response from server
                    submit_btn.val("Upload").prop( "disabled", false); //enable submit button once ajax is done
                });

            }
        }
        $(result_output).html('تم تحميل الصورة بنجاح!');
        $(result_output).show(); //reset output
        $(error).each(function(i){ //output any error to output element
            $(result_output).html('<div class="error">'+error[i]+"</div>");
        });

    });
</script>
</body>
</html>
